<!DOCTYPE html>
<html lang="zh">
<head>
<meta charset="UTF-8">
<title>ä½ çš„å¿ƒåŠ¨å§æ˜¯è°ï¼Ÿ</title>
<style>
* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

body { 
  font-family: -apple-system, BlinkMacSystemFont, "PingFang SC", sans-serif; 
  text-align: center; 
  background: #fafafa;
  min-height: 100vh;
  display: flex;
  flex-direction: column;
}

.container {
  flex: 1;
  display: flex;
  flex-direction: column;
  max-height: calc(100vh - 20px);
  padding: 10px;
}

h1 {
  margin: 10px 0;
  font-size: 1.8em;
  flex-shrink: 0;
}

#status {
  margin: 10px 0;
  font-size: 1.1em;
  flex-shrink: 0;
}

.images-container {
  flex: 1;
  display: flex;
  justify-content: center;
  align-items: center;
  gap: 10px;
  min-height: 0; /* é‡è¦ï¼šé˜²æ­¢å›¾ç‰‡æ’‘å¼€å®¹å™¨ */
  padding: 10px;
}

.image-wrapper {
  flex: 1;
  height: 100%;
  max-width: 48%;
  display: flex;
  justify-content: center;
  align-items: center;
}

img {
  max-width: 100%;
  max-height: 100%;
  width: auto;
  height: auto;
  object-fit: contain;
  cursor: pointer;
  border: 3px solid #ddd;
  border-radius: 14px;
  transition: all 0.25s;
  background: #fff;
  box-shadow: 0 2px 8px rgba(0,0,0,0.1);
}

img:hover {
  transform: scale(1.03);
  border-color: hotpink;
  box-shadow: 0 4px 16px rgba(0,0,0,0.15);
}

.controls {
  flex-shrink: 0;
  margin: 10px 0;
  padding: 10px;
}

#winnerBanner {
  font-size: 1.5em;
  margin: 20px 0;
  display: none;
}

#reviveBtn {
  display: none;
  margin: 10px auto;
  padding: 10px 22px;
  font-size: 1em;
  cursor: pointer;
  border-radius: 20px;
  border: none;
  background: linear-gradient(135deg, #ffb6c1, #ffd1dc);
  transition: transform 0.2s;
}

#reviveBtn:hover {
  transform: scale(1.05);
}

.confetti {
  position: fixed;
  width: 8px;
  height: 8px;
  top: -10px;
  z-index: 9999;
  pointer-events: none;
  animation: fall linear forwards;
}

@keyframes fall {
  from { transform: translateY(0) rotate(0deg); }
  to { transform: translateY(100vh) rotate(360deg); }
}

.flash {
  animation: flash 0.5s 6 alternate;
  border-color: gold !important;
}

@keyframes flash {
  from { box-shadow: 0 0 5px gold; }
  to { box-shadow: 0 0 20px gold; }
}

.winner-image {
  max-width: 50%;
  max-height: 60vh;
  border: 6px solid gold !important;
  border-radius: 18px;
  margin: 20px auto;
}

@media (max-width: 768px) {
  h1 {
    font-size: 1.5em;
    margin: 5px 0;
  }
  
  #status {
    font-size: 1em;
    margin: 5px 0;
  }
  
  .images-container {
    flex-direction: column;
    gap: 8px;
  }
  
  .image-wrapper {
    max-width: 90%;
    max-height: 45%;
  }
  
  .winner-image {
    max-width: 80%;
  }
}

@media (max-height: 700px) {
  .container {
    padding: 5px;
  }
  
  h1 {
    font-size: 1.5em;
    margin: 5px 0;
  }
  
  #status {
    font-size: 0.9em;
    margin: 5px 0;
  }
  
  .images-container {
    padding: 5px;
  }
}
</style>
</head>
<body>

<div class="container">
  <h1>ğŸ’— å¿ƒåŠ¨æ·˜æ±°èµ› ğŸ’—</h1>
  <div id="status">æ¥å§ï¼Œç¬¬ä¸€çœ¼â€”â€”ä½ å¯¹è°æœ€å¿ƒåŠ¨ï¼Ÿ</div>
  
  <div class="images-container">
    <div class="image-wrapper">
      <img id="img1" src="">
    </div>
    <div class="image-wrapper">
      <img id="img2" src="">
    </div>
  </div>
  
  <div class="controls">
    <button id="reviveBtn">ç­‰ç­‰æˆ‘åæ‚”äº†ï¼Œå†ç»™å¥¹ä¸€æ¬¡æœºä¼š ğŸ˜­</button>
    <div id="winnerBanner"></div>
  </div>
</div>

<audio id="bgMusic" loop>
  <source src="bgmusic.mp3" type="audio/mpeg">
  <source src="bgmusic.m4a" type="audio/mp4">
</audio>

<script>
// ===== å‚æ•° =====
const totalImages = 70;
const images = Array.from({length: totalImages}, (_, i) => `${String(i + 1).padStart(3, "0")}.jpg`);

// çŠ¶æ€å˜é‡
let poolA = [...images];           // æœªå¯¹å†³è¿‡çš„ç…§ç‰‡æ± 
let winnersPool = [];              // èµ¢å®¶æ± 
let currentPair = [];
let lastLoser = null;
let reviveUsed = false;
let streakPlayer = null;
let streak = 0;
let firstClickDone = false;
let gameState = 'initial';         // 'initial' | 'poolA_vs_poolA' | 'winnersPool_vs_winnersPool' | 'finished'

// DOMå…ƒç´ 
const img1 = document.getElementById('img1');
const img2 = document.getElementById('img2');
const status = document.getElementById('status');
const reviveBtn = document.getElementById('reviveBtn');
const winnerBanner = document.getElementById('winnerBanner');

// ===== å½©å¸¦æ•ˆæœ =====
function confettiEffect(count = 40) {
  for (let i = 0; i < count; i++) {
    const c = document.createElement('div');
    c.className = 'confetti';
    c.style.left = Math.random() * 100 + 'vw';
    c.style.background = `hsl(${Math.random() * 360}, 70%, 65%)`;
    c.style.animationDuration = (2 + Math.random() * 1.2) + 's';
    document.body.appendChild(c);
    setTimeout(() => c.remove(), 3000);
  }
}

// ===== èƒŒæ™¯éŸ³ä¹é¦–æ¬¡ç‚¹å‡» =====
document.body.addEventListener('click', () => {
  if (!firstClickDone) {
    firstClickDone = true;
    document.getElementById('bgMusic').play().catch(() => {});
    confettiEffect(18);
  }
}, {once: true});

// ===== éšæœºé€‰æ‹©ä¸¤ä¸ªä¸åŒçš„å…ƒç´  =====
function getRandomPair(arr) {
  if (arr.length < 2) return arr;
  const idx1 = Math.floor(Math.random() * arr.length);
  let idx2 = Math.floor(Math.random() * (arr.length - 1));
  if (idx2 >= idx1) idx2++;
  return [arr[idx1], arr[idx2]];
}

// ===== æ›´æ–°å¯¹å†³çŠ¶æ€ =====
function updateGameState() {
  if (poolA.length === 0 && winnersPool.length === 0) {
    gameState = 'finished';
  } else if (poolA.length >= 2) {
    gameState = 'poolA_vs_poolA';
  } else if (poolA.length === 1 && winnersPool.length > 0) {
    gameState = 'poolA_vs_winnersPool';
  } else if (winnersPool.length >= 2) {
    gameState = 'winnersPool_vs_winnersPool';
  } else if (winnersPool.length === 1 && poolA.length === 0) {
    showChampion(winnersPool[0]);
    return;
  }
  
  selectNextPair();
}

// ===== é€‰æ‹©ä¸‹ä¸€å¯¹ =====
function selectNextPair() {
  if (gameState === 'finished') return;
  
  // æ ¹æ®æ¸¸æˆçŠ¶æ€é€‰æ‹©ä¸åŒçš„å¯¹å†³ç­–ç•¥
  if (gameState === 'poolA_vs_poolA') {
    // ä»æœªå¯¹å†³è¿‡çš„ç…§ç‰‡ä¸­éšæœºé€‰æ‹©ä¸¤ä¸ª
    currentPair = getRandomPair(poolA);
    status.textContent = `åˆé‡å¿ƒåŠ¨ ${poolA.length} å¼ å¾…é€‰`;
    
  } else if (gameState === 'poolA_vs_winnersPool') {
    // æœ€åä¸€ä¸ªæœªå¯¹å†³ç…§ç‰‡ä¸èµ¢å®¶æ± éšæœºä¸€ä¸ªå¯¹å†³
    const fromPoolA = poolA[0];
    const fromWinners = winnersPool[Math.floor(Math.random() * winnersPool.length)];
    currentPair = [fromPoolA, fromWinners];
    status.textContent = `æ–°é¢å­” vs å¿ƒåŠ¨è€å‹`;
    
  } else if (gameState === 'winnersPool_vs_winnersPool') {
    // èµ¢å®¶æ± å†…éƒ¨å¯¹å†³
    currentPair = getRandomPair(winnersPool);
    status.textContent = `å¼ºå¼ºå¯¹å†³ ${winnersPool.length} ä½å¿ƒåŠ¨é€‰æ‰‹`;
  }
  
  // æ˜¾ç¤ºå›¾ç‰‡
  img1.src = currentPair[0];
  img2.src = currentPair[1];
  img1.style.display = 'block';
  img2.style.display = 'block';
  
  // é¢„åŠ è½½å›¾ç‰‡ä»¥ç¡®ä¿å°ºå¯¸å‡†ç¡®
  [img1, img2].forEach(img => {
    const image = new Image();
    image.src = img.src;
  });
  
  // æ˜¾ç¤ºå¤æ´»æŒ‰é’®
  if (lastLoser && !reviveUsed) {
    reviveBtn.style.display = 'inline';
  }
}

// ===== ç‚¹å‡»é€‰æ‹© =====
function selectImage(idx) {
  const winner = currentPair[idx];
  const loser = currentPair[1 - idx];
  
  // æ›´æ–°èµ¢å®¶æ± 
  if (!winnersPool.includes(winner)) {
    winnersPool.push(winner);
  }
  
  // ä»ç›¸åº”æ± ä¸­ç§»é™¤è¾“å®¶
  if (poolA.includes(loser)) {
    poolA = poolA.filter(img => img !== loser);
  }
  if (winnersPool.includes(loser)) {
    winnersPool = winnersPool.filter(img => img !== loser);
  }
  
  // å¦‚æœèµ¢å®¶æ¥è‡ªpoolAï¼Œéœ€è¦ç§»åˆ°èµ¢å®¶æ± å¹¶ä»poolAç§»é™¤
  if (poolA.includes(winner)) {
    poolA = poolA.filter(img => img !== winner);
  }
  
  lastLoser = loser;
  
  // è¿èƒœç»Ÿè®¡
  if (streakPlayer === winner) {
    streak++;
  } else {
    streakPlayer = winner;
    streak = 1;
  }
  
  // è¿èƒœå½©å¸¦
  if (streak % 10 === 0) {
    confettiEffect(80);
    status.textContent = `å¤©å‘ï¼å·²ç»è¿ç»­ ${streak} æ¬¡ä¸ºå¥¹å¿ƒåŠ¨ ğŸ’˜`;
  } else {
    status.textContent = `å·²è¿ç»­ ${streak} æ¬¡é€‰æ‹©å¥¹ ğŸ’“`;
  }
  
  // æ›´æ–°æ¸¸æˆçŠ¶æ€å¹¶å‡†å¤‡ä¸‹ä¸€å¯¹
  updateGameState();
}

// ===== å¤æ´»æŒ‰é’® =====
reviveBtn.onclick = () => {
  if (lastLoser && !reviveUsed) {
    // å°†ä¸Šä¸€è½®çš„è¾“å®¶æ”¾å›poolA
    poolA.push(lastLoser);
    reviveUsed = true;
    reviveBtn.style.display = 'none';
    
    // é«˜äº®æ˜¾ç¤ºå¤æ´»çš„äºº
    status.textContent = 'å¥¹å¸¦ç€ä½ çš„å¿ƒæ„å›æ¥äº† ğŸ’–';
    confettiEffect(12);
    
    // å¦‚æœå¤æ´»çš„äººæ­£å¥½åœ¨å½“å‰å¯¹å†³ä¸­ï¼Œé«˜äº®æ˜¾ç¤º
    if (currentPair.includes(lastLoser)) {
      const flashImg = currentPair[0] === lastLoser ? img1 : img2;
      flashImg.classList.add('flash');
      setTimeout(() => flashImg.classList.remove('flash'), 3000);
    }
  }
}

// ===== æ˜¾ç¤ºå† å†› =====
function showChampion(img) {
  gameState = 'finished';
  img1.style.display = 'none';
  img2.style.display = 'none';
  reviveBtn.style.display = 'none';
  status.style.display = 'none';
  
  winnerBanner.style.display = 'block';
  winnerBanner.innerHTML = `
    <div style="margin-bottom: 15px; font-weight: bold;">
      ğŸ‰ æœ€ç»ˆèƒœå‡ºï¼å¥¹å°±æ˜¯ä½ çš„å¿ƒé€‰ ğŸ‰
    </div>
    <img src="${img}" class="winner-image">
    <div style="margin-top: 15px; font-size: 0.9em;">
      è¿èƒœè®°å½•ï¼š${streak} æ¬¡
    </div>
  `;
  
  // å† å†›å½©å¸¦
  confettiEffect(150);
  document.getElementById('bgMusic').pause();
}

// ===== ç»‘å®šç‚¹å‡»äº‹ä»¶ =====
img1.onclick = () => selectImage(0);
img2.onclick = () => selectImage(1);

// ===== å¯åŠ¨æ¸¸æˆ =====
updateGameState();
</script>
</body>
</html>
