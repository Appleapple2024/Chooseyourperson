<!DOCTYPE html>
<html lang="zh">
<head>
<meta charset="UTF-8">
<title>æ·˜æ±°å›¾ç‰‡æ¸¸æˆ</title>
<style>
  body { font-family: sans-serif; text-align: center; background: #f9f9f9; overflow-x: hidden; }
  img { max-width: 45%; margin: 1%; cursor: pointer; border: 3px solid #ccc; border-radius: 10px; transition: all 0.3s; }
  img:hover { transform: scale(1.05); border-color: gold; }
  #winnerBanner { font-size: 2em; color: red; margin-top: 20px; display:none; }
  #status { margin: 20px; font-size: 1.2em; }
  #reviveBtn { display: none; margin: 10px auto; padding: 10px 20px; font-size: 1em; cursor: pointer; animation: blink 1s infinite; }
  @keyframes blink {
    0%,100% {background-color:#ffcccc;}
    50% {background-color:#ffeeaa;}
  }
  .confetti {
    position: fixed;
    width: 10px;
    height: 10px;
    top: -10px;
    z-index: 9999;
    opacity: 0.8;
    pointer-events: none;
    animation: fall 3s linear forwards;
  }
  @keyframes fall {
    0% {transform: rotate(0deg) translateY(0);}
    100% {transform: rotate(360deg) translateY(100vh);}
  }
</style>
</head>
<body>
<h1>æ·˜æ±°å›¾ç‰‡æ¸¸æˆ</h1>
<div id="status">ç‚¹å‡»å›¾ç‰‡é€‰æ‹©ä½ å–œæ¬¢çš„</div>
<div>
  <img id="img1" src="" alt="">
  <img id="img2" src="" alt="">
</div>
<button id="reviveBtn">å¤æ´»ä¸€æ¬¡å¤±è´¥çš„å›¾ç‰‡</button>
<div id="winnerBanner"></div>

<!-- èƒŒæ™¯éŸ³ä¹ -->
<audio id="bgMusic" src="bgmusic.mp3" loop></audio>

<!-- ç‚¹å‡»éŸ³æ•ˆï¼ˆå¯é€‰ï¼Œå¦‚æœæ²¡ä¸Šä¼ ä¹Ÿä¸ä¼šæŠ¥é”™ï¼‰ -->
<audio id="clickSound"></audio>

<script>
// ----------- é»˜è®¤å›¾ç‰‡æ•°ç»„ -----------
const defaultImages = Array.from({length:70}, (_,i) =>
  `${String(i+1).padStart(3,"0")}.jpg`
);

let pool = [...defaultImages];
let winners = [];
let streak = 0;
let currentPair = [];
let lastLoser = null;
let reviveUsed = false;
let firstClickDone = false; // ç”¨äºåˆ¤æ–­ç”¨æˆ·ç¬¬ä¸€æ¬¡ç‚¹å‡»

// å½©å¸¦ç‰¹æ•ˆ
function confettiEffect(count=30){
  for(let i=0;i<count;i++){
    const conf = document.createElement('div');
    conf.className='confetti';
    conf.style.left = Math.random()*100+'vw';
    conf.style.backgroundColor = `hsl(${Math.random()*360}, 80%, 60%)`;
    conf.style.width = conf.style.height = (5+Math.random()*10)+'px';
    document.body.appendChild(conf);
    setTimeout(()=>conf.remove(),3000);
  }
}

// ç”¨æˆ·ç¬¬ä¸€æ¬¡ç‚¹å‡»ï¼Œå¯åŠ¨èƒŒæ™¯éŸ³ä¹ + å°å½©å¸¦
function handleFirstClick() {
  if(!firstClickDone){
    firstClickDone = true;
    const bg = document.getElementById('bgMusic');
    bg.play().catch(()=>console.log("ç‚¹å‡»å¼€å§‹éŸ³ä¹"));
    confettiEffect(20);
  }
}
document.body.addEventListener('click', handleFirstClick, { once: true });

// éšæœºç”Ÿæˆä¸‹ä¸€å¯¹å›¾ç‰‡
function nextPair() {
  if(pool.length === 0 && winners.length === 1) {
    showChampion(winners[0]);
    return;
  }

  if(pool.length === 0) {
    pool = [...winners];
    winners = [];
  }

  if(pool.length === 1) {
    currentPair = [pool[0]];
    document.getElementById('img1').src = pool[0];
    document.getElementById('img2').style.display = 'none';
    document.getElementById('status').textContent = 'æœ€åä¸€å¼ ï¼Œç‚¹å‡»é€‰æ‹©èƒœè€…';
    return;
  } else {
    document.getElementById('img2').style.display = 'inline';
  }

  let idx1 = Math.floor(Math.random() * pool.length);
  let img1 = pool.splice(idx1,1)[0];
  let idx2 = Math.floor(Math.random() * pool.length);
  let img2 = pool.splice(idx2,1)[0];

  currentPair = [img1,img2];
  document.getElementById('img1').src = img1;
  document.getElementById('img2').src = img2;
  document.getElementById('status').textContent = `ç‚¹å‡»ä½ å–œæ¬¢çš„å›¾ç‰‡`;
}

// ç‚¹å‡»é€‰æ‹©
function selectImage(selectedIdx) {
  // æ’­æ”¾ç‚¹å‡»éŸ³æ•ˆï¼ˆå¦‚æœå­˜åœ¨æ‰æ’­æ”¾ï¼‰
  const clickSound = document.getElementById('clickSound');
  if(clickSound && clickSound.src) clickSound.play();

  let winner = currentPair[selectedIdx];
  let loser = currentPair[1 - selectedIdx];

  winners.push(winner);
  streak++;
  lastLoser = loser;

  const statusEl = document.getElementById('status');
  statusEl.textContent = `è¿èƒœ: ${streak}`;
  statusEl.style.color = ['red','orange','green','blue','purple'][streak%5];

  // èƒœè€…ç¼©æ”¾åŠ¨ç”»
  const winnerImg = selectedIdx === 0 ? document.getElementById('img1') : document.getElementById('img2');
  winnerImg.style.transform = 'scale(1.2)';
  setTimeout(()=>{ winnerImg.style.transform='scale(1)'; }, 200);

  // å½©å¸¦æ•ˆæœ
  confettiEffect(20);

  // è¿èƒœå½©è›‹
  if([10,20,30].includes(streak)){
      let originalBg = document.body.style.background;
      document.body.style.background = '#fffa66';
      setTimeout(()=>{document.body.style.background = originalBg},200);
      confettiEffect(50);
      confettiEffect(50);
  }

  // æ˜¾ç¤ºå¤æ´»æŒ‰é’®
  if(!reviveUsed && lastLoser) {
    document.getElementById('reviveBtn').style.display = 'inline';
  }

  nextPair();
}

// å¤æ´»
document.getElementById('reviveBtn').onclick = function() {
  if(lastLoser && !reviveUsed) {
    pool.push(lastLoser);
    reviveUsed = true;
    this.style.display = 'none';
    document.getElementById('status').textContent = `å¤æ´»æˆåŠŸï¼ç»§ç»­æ¸¸æˆï¼Œè¿èƒœ: ${streak}`;
    confettiEffect(10);
  }
}

// æ˜¾ç¤ºå† å†›
function showChampion(img) {
  document.getElementById('img1').style.display = 'none';
  document.getElementById('img2').style.display = 'none';
  document.getElementById('status').style.display = 'none';
  document.getElementById('reviveBtn').style.display = 'none';

  const banner = document.getElementById('winnerBanner');
  banner.textContent = `å† å†›ç”Ÿå­˜æµ·æŠ¥ ğŸ‰`;
  banner.style.display = 'block';

  const champImg = document.createElement('img');
  champImg.src = img;
  champImg.style.maxWidth = '50%';
  champImg.style.border = '5px solid gold';
  champImg.style.borderRadius = '15px';
  champImg.style.transform='scale(0)';
  champImg.style.transition='transform 0.5s';
  banner.appendChild(document.createElement('br'));
  banner.appendChild(champImg);
  setTimeout(()=>{ champImg.style.transform='scale(1)'; },100);

  // å† å†›å½©å¸¦åº†ç¥
  confettiEffect(50);
}

// ç»‘å®šç‚¹å‡»
document.getElementById('img1').onclick = () => selectImage(0);
document.getElementById('img2').onclick = () => selectImage(1);

// åˆå§‹åŒ–
nextPair();
</script>
</body>
</html>
