<!DOCTYPE html>
<html lang="zh">
<head>
<meta charset="UTF-8">
<title>ä½ æ›´å–œæ¬¢è° Â· å¨±ä¹æ·˜æ±°åˆ¶</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
  body {
    margin: 0;
    font-family: system-ui, -apple-system;
    background: #0f0f0f;
    color: #fff;
    text-align: center;
  }
  h1, h2 { font-weight: 600; }
  #arena img {
    width: 42vw;
    max-width: 320px;
    margin: 10px;
    border-radius: 14px;
    cursor: pointer;
    transition: transform 0.2s;
  }
  #arena img:hover { transform: scale(1.05); }
  button {
    background: #fff;
    color: #000;
    border: none;
    padding: 10px 16px;
    border-radius: 10px;
    font-size: 15px;
    cursor: pointer;
    margin: 6px;
  }
  #footer {
    font-size: 12px;
    opacity: 0.6;
    margin: 20px;
  }
</style>
</head>

<body>

<h2 id="status">è¯·é€‰æ‹©ä½ æ›´å–œæ¬¢çš„</h2>

<div>
  <input type="file" id="uploader" multiple accept="image/*">
</div>

<div id="arena"></div>
<div id="controls"></div>

<div id="footer">
  æœ¬ç½‘ç«™ä»…ä¾›å¨±ä¹ã€‚é»˜è®¤å›¾ç‰‡ç”±ç«™ç‚¹æä¾›ï¼Œç”¨æˆ·ä¸Šä¼ å›¾ç‰‡ä»…åœ¨æœ¬åœ°æµè§ˆå™¨ä¸­ä½¿ç”¨ï¼Œä¸ä¼šè¢«ä¿å­˜æˆ–ä¸Šä¼ ã€‚
</div>

<script>
/* ====== 1. é»˜è®¤å›¾ç‰‡ï¼ˆ70 å¼ ï¼‰ ====== */
const defaultImages = Array.from({length:70}, (_,i) =>
  `${String(i+1).padStart(3,"0")}.jpg`
);

/* ====== 2. ç”¨æˆ·å›¾ç‰‡ ====== */
let userImages = [];

/* ====== 3. æ¸¸æˆçŠ¶æ€ ====== */
let pool = [...defaultImages];
let lastEliminated = null;
let reviveUsed = false;
let streakOwner = null;
let streakCount = 0;

/* ====== 4. ä¸Šä¼ å¤„ç† ====== */
document.getElementById("uploader").addEventListener("change", e => {
  const files = Array.from(e.target.files);
  files.forEach(file => {
    const url = URL.createObjectURL(file);
    userImages.push(url);
    pool.push(url);
  });
});

/* ====== 5. ä¸»æµç¨‹ ====== */
function nextRound() {
  const arena = document.getElementById("arena");
  const controls = document.getElementById("controls");
  arena.innerHTML = "";
  controls.innerHTML = "";

  if (pool.length === 1) {
    showChampion(pool[0]);
    return;
  }

  shuffle(pool);
  const a = pool[0];
  const b = pool[1];

  [a, b].forEach(img => {
    const el = document.createElement("img");
    el.src = img;
    el.onclick = () => choose(img, img === a ? b : a);
    arena.appendChild(el);
  });

  if (!reviveUsed && lastEliminated) {
    const btn = document.createElement("button");
    btn.innerText = "ğŸ” å¤æ´»ä¸€æ¬¡";
    btn.onclick = revive;
    controls.appendChild(btn);
  }
}

/* ====== 6. é€‰æ‹©é€»è¾‘ ====== */
function choose(winner, loser) {
  if (pool.length === 2) {
    if (!confirm("âš ï¸ è¿™æ˜¯æœ€åçš„é€‰æ‹©äº†ï¼Œä½ ç¡®å®šå—ï¼Ÿ")) return;
  }

  if (streakOwner === winner) {
    streakCount++;
  } else {
    streakOwner = winner;
    streakCount = 1;
  }

  updateStatus();

  lastEliminated = loser;
  pool = pool.filter(i => i !== loser);
  nextRound();
}

/* ====== 7. è¿èƒœæç¤º ====== */
function updateStatus() {
  const s = document.getElementById("status");
  if (streakCount === 2) s.innerText = "âœ¨ æœ‰ç‚¹ä¸œè¥¿";
  else if (streakCount === 3) s.innerText = "ğŸ”¥ å¥¹æ€ç–¯äº†";
  else if (streakCount >= 5) s.innerText = "ğŸ‘‘ ç»Ÿæ²»çº§";
  else s.innerText = "è¯·é€‰æ‹©ä½ æ›´å–œæ¬¢çš„";
}

/* ====== 8. å¤æ´» ====== */
function revive() {
  reviveUsed = true;
  pool.push(lastEliminated);
  lastEliminated = null;
  nextRound();
}

/* ====== 9. å† å†›æµ·æŠ¥ ====== */
function showChampion(img) {
  document.body.innerHTML = `
    <h1>ğŸ‘‘ å† å†›ç”Ÿå­˜ ğŸ‘‘</h1>
    <img src="${img}" style="width:70vw;max-width:380px;border-radius:16px">
    <p>å¥¹èµ¢åˆ°äº†æœ€åã€‚</p>
  `;
}

/* ====== å·¥å…· ====== */
function shuffle(arr) {
  for (let i = arr.length - 1; i > 0; i--) {
    const j = Math.floor(Math.random() * (i + 1));
    [arr[i], arr[j]] = [arr[j], arr[i]];
  }
}

/* ====== å¯åŠ¨ ====== */
nextRound();
</script>

</body>
</html>
