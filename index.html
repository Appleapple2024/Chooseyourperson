<!DOCTYPE html>
<html lang="zh">
<head>
<meta charset="UTF-8">
<title>‰Ω†ÂØπË∞ÅÊúÄÂøÉÂä®Ôºü>i‚ÄÜni>it
<style>
  body { font-family: sans-serif; text-align: center; background: #f9f9f9; overflow-x: hidden; }
  img { max-width: 45%; margin: 1%; cursor: pointer; border: 3px solid #ccc; border-radius: 10px; transition: all 0.3s; }
  img:hover { transform: scale(1.05); border-color: gold; }
  #winnerBanner { font-size: 2em; color: red; margin-top: 20px; display:none; }
  #status { margin: 20px; font-size: 1.2em; }
  #reviveBtn { display: none; margin: 10px auto; padding: 10px 20px; font-size: 1em; cursor: pointer; animation: blink 1s infinite; }
  @keyframes blink {
    0%,100% {background-color:#ffcccc;}
    50% {background-color:#ffeeaa;}
  }
  .confetti {
    position: fixed;
    width: 10px;
    height: 10px;
    top: -10px;
    z-index: 9999;
    opacity: 0.8;
    pointer-events: none;
    animation: fall linear forwards;
  }
  @keyframes fall {
    0% {transform: rotate(0deg) translateY(0);}
    100% {transform: rotate(360deg) translateY(100vh);}
  }
</style>
</head>
<body>
<h1>‰Ω†ÂØπË∞ÅÊúÄÂøÉÂä®Ôºü>ni‚ÄÜd
<div id="status">ÂºÄÈÄâÂêßÔºÅ>xuan‚ÄÜ
<div>
  <img id="img1" src="" alt="">
  <img id="img2" src="" alt="">
</div>
<button id="reviveBtn">‰∏ÄÊûöÂ§çÊ¥ªÂç°>k‚ÄÜla>k‚ÄÜl
<div id="winnerBanner"></div>

<!-- ËÉåÊôØÈü≥‰πêÔºàÂèåÊ†ºÂºèÊîØÊåÅÔºâ -->
<audio id="bgMusic" loop>
  <source src="bgmusic.mp3" type="audio/mpeg">
  <source src="bgmusic.m4a" type="audio/mp4">
</audio>

<!-- ÁÇπÂáªÈü≥ÊïàÔºàÂèØÈÄâÔºâ -->
<audio id="clickSound"></audio>

<script>
// ---------- ÈªòËÆ§ÂõæÁâáÊï∞ÁªÑ ----------
const defaultImages = Array.from({length:70}, (_,i) =>
  `${String(i+1).padStart(3,"0")}.jpg`
);

let pool = [...defaultImages];
let winners = [];
let streak = 0;
let currentPair = [];
let lastLoser = null;
let reviveUsed = false;
let firstClickDone = false;

// ---------- ÁÇ´ÂΩ©Â∏¶ÂáΩÊï∞ ----------
function confettiEffect(count=50){
  for(let i=0;i<count;i++){
    const conf = document.createElement('div');
    conf.className='confetti';
    conf.style.left = Math.random()*100+'vw';
    
    conf.style.backgroundColor = `hsl(${Math.random()*360}, 70%, 60%)`;
    
    let size = 5 + Math.random()*10;
    conf.style.width = conf.style.height = size+'px';
    conf.style.opacity = 0.8;
    
    let duration = 2 + Math.random()*1.5;
    conf.style.animationDuration = duration+'s';
    
    conf.style.transform = `rotate(${Math.random()*30-15}deg)`;
    
    document.body.appendChild(conf);
    
    setTimeout(()=>{ 
      conf.style.transition = 'opacity 0.5s';
      conf.style.opacity = 0;
    }, (duration-0.5)*1000);
    
    setTimeout(()=>conf.remove(), duration*1000);
  }
}

// ---------- Áî®Êà∑Á¨¨‰∏ÄÊ¨°ÁÇπÂáª ----------
function handleFirstClick() {
  if(!firstClickDone){
    firstClickDone = true;
    const bg = document.getElementById('bgMusic');
    bg.play().catch(()=>console.log("ËÉåÊôØÈü≥‰πê"));
    // Á¨¨‰∏ÄÊ¨°ÁÇπÂáªÂΩ©Â∏¶ÔºåÊï∞ÈáèÂ∞ë
    confettiEffect(20);
  }
}
document.body.addEventListener('click', handleFirstClick, { once: true });

// ---------- ‰∏ã‰∏ÄÂØπÂõæÁâá ----------
function nextPair() {
  if(pool.length === 0 && winners.length === 1) {
    showChampion(winners[0]);
    return;
  }
  if(pool.length === 0) {
    pool = [...winners];
    winners = [];
  }
  if(pool.length === 1) {
    currentPair = [pool[0]];
    document.getElementById('img1').src = pool[0];
    document.getElementById('img2').style.display = 'none';
    document.getElementById('status').textContent = 'Êè≠Êôì‰ª§‰Ω†ÂøÉÂä®ÁöÑÂ•πÔºÅ';
    return;
  } else {
    document.getElementById('img2').style.display = 'inline';
  }

  let idx1 = Math.floor(Math.random() * pool.length);
  let img1 = pool.splice(idx1,1)[0];
  let idx2 = Math.floor(Math.random() * pool.length);
  let img2 = pool.splice(idx2,1)[0];

  currentPair = [img1,img2];
  document.getElementById('img1').src = img1;
  document.getElementById('img2').src = img2;
  document.getElementById('status').textContent = `ÈÄâ‰Ω†ÂñúÊ¨¢`;
}

// ---------- ÁÇπÂáªÈÄâÊã© ----------
function selectImage(selectedIdx) {
  const clickSound = document.getElementById('clickSound');
  if(clickSound && clickSound.src) clickSound.play();

  let winner = currentPair[selectedIdx];
  let loser = currentPair[1 - selectedIdx];

  winners.push(winner);
  streak++;
  lastLoser = loser;

  const statusEl = document.getElementById('status');
  statusEl.textContent = `ËøûËÉú: ${streak}`;
  statusEl.style.color = ['red','orange','green','blue','purple'][streak%5];

  const winnerImg = selectedIdx === 0 ? document.getElementById('img1') : document.getElementById('img2');
  winnerImg.style.transform = 'scale(1.2)';
  setTimeout(()=>{ winnerImg.style.transform='scale(1)'; }, 200);

  // ---------- ËøûËÉúÂΩ©Â∏¶ 10/20/30 ----------
  if([10,20,30].includes(streak)){
      confettiEffect(80);
  }

  // ---------- ÊòæÁ§∫Â§çÊ¥ªÊåâÈíÆ ----------
  if(!reviveUsed && lastLoser) {
    document.getElementById('reviveBtn').style.display = 'inline';
  }

  nextPair();
}

// ---------- Â§çÊ¥ª ----------
document.getElementById('reviveBtn').onclick = function() {
  if(lastLoser && !reviveUsed) {
    pool.push(lastLoser);
    reviveUsed = true;
    this.style.display = 'none';
    document.getElementById('status').textContent = `Â§çÊ¥ªÊàêÂäüÔºÅÁªßÁª≠Ê∏∏ÊàèÔºåËøûËÉú: ${streak}`;
    confettiEffect(10);
  }
}

// ---------- ÂÜ†ÂÜõÊòæÁ§∫ ----------
function showChampion(img) {
  document.getElementById('img1').style.display = 'none';
  document.getElementById('img2').style.display = 'none';
  document.getElementById('status').style.display = 'none';
  document.getElementById('reviveBtn').style.display = 'none';

  const banner = document.getElementById('winnerBanner');
  banner.textContent = `ÂøÉÂä®Âßê üéâ`;
  banner.style.display = 'block';

  const champImg = document.createElement('img');
  champImg.src = img;
  champImg.style.maxWidth = '50%';
  champImg.style.border = '5px solid gold';
  champImg.style.borderRadius = '15px';
  champImg.style.transform='scale(0)';
  champImg.style.transition='transform 0.5s';
  banner.appendChild(document.createElement('br'));
  banner.appendChild(champImg);
  setTimeout(()=>{ champImg.style.transform='scale(1)'; },100);

  confettiEffect(120);
}

// ---------- ÁªëÂÆöÁÇπÂáª ----------
document.getElementById('img1').onclick = () => selectImage(0);
document.getElementById('img2').onclick = () => selectImage(1);

// ---------- ÂàùÂßãÂåñ ----------
nextPair();
</script>
</body>
</html>
