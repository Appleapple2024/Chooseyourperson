<!DOCTYPE html>
<html lang="zh">
<head>
<meta charset="UTF-8">
<title>å¿ƒåŠ¨æ·˜æ±°èµ›</title>
<style>
  body {
    font-family: -apple-system, BlinkMacSystemFont, "PingFang SC", sans-serif;
    text-align: center;
    background: #fafafa;
    overflow-x: hidden;
  }
  h1 { margin-top: 20px; }
  img {
    max-width: 45%;
    margin: 1%;
    cursor: pointer;
    border: 3px solid #ddd;
    border-radius: 14px;
    transition: all 0.25s ease;
  }
  img:hover {
    transform: scale(1.06);
    border-color: hotpink;
  }
  #status { margin: 18px; font-size: 1.2em; }
  #winnerBanner {
    font-size: 2em;
    margin-top: 30px;
    display: none;
  }
  #reviveBtn {
    display: none;
    margin: 14px auto;
    padding: 10px 22px;
    font-size: 1em;
    cursor: pointer;
    border-radius: 20px;
    border: none;
    background: linear-gradient(135deg,#ffb6c1,#ffd1dc);
  }
  .confetti {
    position: fixed;
    width: 8px;
    height: 8px;
    top: -10px;
    z-index: 9999;
    pointer-events: none;
    animation: fall linear forwards;
  }
  @keyframes fall { from { transform: translateY(0) rotate(0deg); } to { transform: translateY(100vh) rotate(360deg); } }
  /* ===== å¤æ´»é—ªçƒåŠ¨ç”» ===== */
  .flash {
    animation: flashAnim 1s ease 0s 3;
  }
  @keyframes flashAnim {
    0%,100% { opacity: 1; }
    50% { opacity: 0; }
  }
</style>
</head>
<body>

<h1>ğŸ’— å¿ƒåŠ¨æ·˜æ±°èµ› ğŸ’—</h1>

<div id="status">æ¥å§ï¼Œç¬¬ä¸€çœ¼â€”â€”ä½ å¯¹è°æœ€å¿ƒåŠ¨ï¼Ÿ</div>

<div>
  <img id="img1" src="">
  <img id="img2" src="">
</div>

<button id="reviveBtn">ç­‰ç­‰æˆ‘åæ‚”äº†ï¼Œå†ç»™å¥¹ä¸€æ¬¡æœºä¼š ğŸ˜­</button>

<div id="winnerBanner"></div>

<audio id="bgMusic" loop>
  <source src="bgmusic.mp3" type="audio/mpeg">
  <source src="bgmusic.m4a" type="audio/mp4">
</audio>

<script>
const defaultImages = Array.from({length:70}, (_,i)=>`${String(i+1).padStart(3,"0")}.jpg`);

let pool = [...defaultImages];
let winners = [];
let lastLoser = null;
let reviveUsed = false;
let streak = 0;
let currentPair = [];
let firstClickDone = false;
let reviveFlashNext = false; // âœ… å¤æ´»é—ªçƒæ ‡è®°

/* ===== å½©å¸¦ ===== */
function confettiEffect(count=40){
  for(let i=0;i<count;i++){
    const c = document.createElement('div');
    c.className='confetti';
    c.style.left = Math.random()*100+'vw';
    c.style.background = `hsl(${Math.random()*360},70%,65%)`;
    c.style.animationDuration = (2+Math.random()*1.2)+'s';
    document.body.appendChild(c);
    setTimeout(()=>c.remove(),3000);
  }
}

/* ===== ç¬¬ä¸€æ¬¡ç‚¹å‡» ===== */
document.body.addEventListener('click',()=>{
  if(!firstClickDone){
    firstClickDone = true;
    document.getElementById('bgMusic').play().catch(()=>{});
    confettiEffect(18);
  }
},{once:true});

/* ===== é…å¯¹ä¸‹ä¸€åœº ===== */
function nextPair(){
  if(pool.length===0){
    if(winners.length===1){
      showChampion(winners[0]);
      return;
    } else if(winners.length===0){
      status.textContent = 'å—¯...å¥½åƒæ²¡äººäº†ï¼Ÿ';
      return;
    } else {
      pool = [...winners];
      winners = [];
    }
  }

  if(pool.length===1){
    currentPair = [pool[0]];
    img1.src = pool[0];
    img2.style.display = 'none';
    status.textContent = 'æœ€åä¸€çœ¼äº†ï¼Œä½ ç¡®å®šæ˜¯å¥¹å—ï¼Ÿ';
    return;
  } else {
    img2.style.display = 'inline';
  }

  const a = pool.shift();
  const b = pool.shift();
  currentPair = [a,b];
  img1.src = a;
  img2.src = b;
  status.textContent = 'åˆ«çŠ¹è±«ï¼Œä½ å¯¹è°æœ€å¿ƒåŠ¨ï¼Ÿ';

  // âœ… å¤æ´»é—ªçƒæç¤º
  if(reviveFlashNext){
    const flashImg = img1.src===lastLoser ? img1 : img2;
    flashImg.classList.add('flash');
    setTimeout(()=>flashImg.classList.remove('flash'), 3000);
    reviveFlashNext = false;
  }
}

/* ===== ç‚¹å‡»é€‰æ‹© ===== */
function selectImage(idx){
  const winner = currentPair[idx];
  const loser = currentPair[1-idx];

  winners.push(winner);
  lastLoser = loser;
  streak++;
  status.textContent = `å·²ç»è¿ç»­ ${streak} æ¬¡ä¸ºå¥¹å¿ƒåŠ¨äº† ğŸ’“`;

  if([10,20,30].includes(streak)){
    confettiEffect(80);
  }

  if(!reviveUsed){
    reviveBtn.style.display='inline';
  }

  nextPair();
}

/* ===== å¤æ´»æŒ‰é’®ï¼ˆä¼˜å…ˆå‡ºåœº + é—ªçƒæç¤ºï¼‰ ===== */
reviveBtn.onclick = ()=>{
  if(lastLoser && !reviveUsed){
    pool.unshift(lastLoser);
    reviveUsed = true;
    reviveBtn.style.display='none';
    status.textContent = 'è¡Œå§ï¼Œè¿™æ¬¡ç®—ä½ å¿ƒè½¯ ğŸ˜Œ';
    confettiEffect(12);
    reviveFlashNext = true; // æ ‡è®°ä¸‹ä¸€åœºé—ªçƒ
  }
};

/* ===== å† å†›æ˜¾ç¤º ===== */
function showChampion(img){
  img1.style.display='none';
  img2.style.display='none';
  reviveBtn.style.display='none';
  status.style.display='none';

  winnerBanner.style.display='block';
  winnerBanner.innerHTML='ğŸ‰ åŸæ¥å¥¹ä¸€ç›´éƒ½æ˜¯ä½ çš„å¿ƒé€‰å§ ğŸ‰<br>';

  const c = document.createElement('img');
  c.src = img;
  c.style.maxWidth='55%';
  c.style.border='6px solid gold';
  c.style.borderRadius='18px';
  winnerBanner.appendChild(c);

  confettiEffect(120);
}

/* ===== ç»‘å®šç‚¹å‡» ===== */
img1.onclick=()=>selectImage(0);
img2.onclick=()=>selectImage(1);

/* ===== å¯åŠ¨ ===== */
nextPair();
</script>

</body>
</html>
