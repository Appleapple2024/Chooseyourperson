<!DOCTYPE html>
<html lang="zh">
<head>
<meta charset="UTF-8">
<title>å¿ƒåŠ¨æ·˜æ±°èµ›</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<style>
* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

body { 
  font-family: -apple-system, BlinkMacSystemFont, "PingFang SC", sans-serif; 
  text-align: center; 
  background: #fafafa;
  min-height: 100vh;
  display: flex;
  flex-direction: column;
  padding: 12px;
}

h1 {
  margin: 0 0 8px;
  font-size: clamp(1.5em, 4vw, 2em);
  color: #ff6b9d;
  flex-shrink: 0;
}

#status {
  margin: 0 0 12px;
  font-size: clamp(1em, 3vw, 1.3em);
  min-height: 2.5em;
  display: flex;
  align-items: center;
  justify-content: center;
  color: #555;
  flex-shrink: 0;
  padding: 0 5px;
}

.images-container {
  display: flex;
  justify-content: center;
  align-items: center;
  gap: 15px;
  margin: 0 0 10px;
  flex: 1;
  width: 100%;
  min-height: 180px;
}

.image-wrapper {
  flex: 1;
  max-width: 48%;
  display: flex;
  justify-content: center;
  align-items: center;
  border: 2px solid #eee;
  border-radius: 12px;
  background: #fff;
  box-shadow: 0 3px 10px rgba(0,0,0,0.08);
  overflow: hidden;
  /* é«˜åº¦é€šè¿‡JSåŠ¨æ€è®¾ç½® */
}

img {
  max-width: 100%;
  max-height: 100%;
  width: auto;
  height: 100%;
  object-fit: contain;
  cursor: pointer;
  border-radius: 8px;
  transition: transform 0.2s;
}

img:hover {
  transform: scale(1.03);
}

.controls {
  margin: 10px 0 5px;
  min-height: 50px;
  flex-shrink: 0;
}

#winnerBanner {
  font-size: 1.5em;
  margin: 15px 0;
  display: none;
}

#reviveBtn {
  display: none;
  margin: 8px auto;
  padding: 10px 22px;
  font-size: 1em;
  cursor: pointer;
  border-radius: 20px;
  border: none;
  background: linear-gradient(135deg, #ffb6c1, #ffd1dc);
  color: #333;
  font-weight: 500;
}

.confetti {
  position: fixed;
  width: 8px;
  height: 8px;
  top: -10px;
  z-index: 9999;
  pointer-events: none;
  animation: fall linear forwards;
}

@keyframes fall {
  from { transform: translateY(0) rotate(0deg); }
  to { transform: translateY(100vh) rotate(360deg); }
}

.flash {
  animation: flash 0.5s 6 alternate;
  border-color: gold !important;
}

@keyframes flash {
  from { box-shadow: 0 0 5px gold; }
  to { box-shadow: 0 0 20px gold; }
}

.winner-image {
  max-width: 70%;
  max-height: 50vh;
  border: 6px solid gold !important;
  border-radius: 15px;
  margin: 15px auto;
}

/* æ‰‹æœºç«–å± */
@media (max-width: 767px) and (orientation: portrait) {
  body {
    padding: 10px;
  }
  
  .images-container {
    gap: 12px;
  }
}

/* æ‰‹æœºæ¨ªå± */
@media (max-width: 767px) and (orientation: landscape) {
  .images-container {
    gap: 20px;
  }
}

/* iPad & å¹³æ¿ */
@media (min-width: 768px) {
  body {
    padding: 20px;
  }
  
  h1 {
    margin: 0 0 15px;
    font-size: clamp(1.8em, 4vw, 2.5em);
  }
  
  #status {
    margin: 0 0 20px;
    font-size: clamp(1.2em, 3vw, 1.5em);
  }
  
  .images-container {
    gap: 25px;
  }
}

/* iPadæ¨ªå± */
@media (min-width: 768px) and (orientation: landscape) {
  .images-container {
    gap: 35px;
  }
}

/* å¤§å±å¹• */
@media (min-width: 1024px) {
  body {
    padding: 25px;
  }
  
  .images-container {
    gap: 40px;
  }
}
</style>
</head>
<body>

<h1>ğŸ’— å¿ƒåŠ¨æ·˜æ±°èµ› ğŸ’—</h1>
<div id="status">æ¥å§ï¼Œç¬¬ä¸€çœ¼â€”â€”ä½ å¯¹è°æœ€å¿ƒåŠ¨ï¼Ÿ</div>

<div class="images-container">
  <div class="image-wrapper">
    <img id="img1" src="">
  </div>
  <div class="image-wrapper">
    <img id="img2" src="">
  </div>
</div>

<div class="controls">
  <button id="reviveBtn">ç­‰ç­‰æˆ‘åæ‚”äº†ï¼Œå†ç»™å¥¹ä¸€æ¬¡æœºä¼š ğŸ˜­</button>
  <div id="winnerBanner"></div>
</div>

<audio id="bgMusic" loop volume="0.35">
  <source src="bgmusic.mp3" type="audio/mpeg">
  <source src="bgmusic.m4a" type="audio/mp4">
</audio>

<script>
// ===== æ ¸å¿ƒï¼šåŠ¨æ€è®¡ç®—å›¾ç‰‡é«˜åº¦ =====
function calculateImageHeight() {
  const windowHeight = window.innerHeight;
  const windowWidth = window.innerWidth;
  
  // è®¡ç®—æ ‡é¢˜å’ŒçŠ¶æ€åŒºåŸŸçš„é«˜åº¦
  const headerHeight = document.querySelector('h1').offsetHeight;
  const statusHeight = document.getElementById('status').offsetHeight;
  const controlsHeight = document.querySelector('.controls').offsetHeight;
  
  // è®¡ç®—å¯ç”¨é«˜åº¦ï¼ˆæ€»é«˜åº¦å‡å»å…¶ä»–å…ƒç´ é«˜åº¦å’Œé—´è·ï¼‰
  const padding = 50; // ä¸Šä¸‹paddingé¢„ç•™ç©ºé—´
  const availableHeight = windowHeight - headerHeight - statusHeight - controlsHeight - padding;
  
  // æ ¹æ®å±å¹•æ–¹å‘è°ƒæ•´é«˜åº¦
  let imageHeight;
  
  if (windowWidth >= 768) { // iPadåŠä»¥ä¸Š
    imageHeight = Math.min(availableHeight * 0.7, windowHeight * 0.55);
    imageHeight = Math.max(imageHeight, 250); // æœ€å°250px
  } else if (windowWidth >= 480) { // æ™®é€šæ‰‹æœº
    imageHeight = Math.min(availableHeight * 0.65, windowHeight * 0.45);
    imageHeight = Math.max(imageHeight, 180); // æœ€å°180px
  } else { // å°æ‰‹æœº
    imageHeight = Math.min(availableHeight * 0.6, windowHeight * 0.4);
    imageHeight = Math.max(imageHeight, 150); // æœ€å°150px
  }
  
  // åº”ç”¨åˆ°å›¾ç‰‡å®¹å™¨
  const wrappers = document.querySelectorAll('.image-wrapper');
  wrappers.forEach(wrapper => {
    wrapper.style.height = `${imageHeight}px`;
  });
  
  return imageHeight;
}

// ===== å‚æ•° =====
const totalImages = 70;
const images = Array.from({length: totalImages}, (_, i) => `${String(i + 1).padStart(3, "0")}.jpg`);

// çŠ¶æ€å˜é‡
let poolA = [...images];
let winnersPool = [];
let currentPair = [];
let lastLoser = null;
let reviveUsed = false;
let streakPlayer = null;
let streak = 0;
let firstClickDone = false;
let gameState = 'initial';

// DOMå…ƒç´ 
const img1 = document.getElementById('img1');
const img2 = document.getElementById('img2');
const status = document.getElementById('status');
const reviveBtn = document.getElementById('reviveBtn');
const winnerBanner = document.getElementById('winnerBanner');
const bgMusic = document.getElementById('bgMusic');

// ===== å½©å¸¦æ•ˆæœ =====
function confettiEffect(count = 40) {
  for (let i = 0; i < count; i++) {
    const c = document.createElement('div');
    c.className = 'confetti';
    c.style.left = Math.random() * 100 + 'vw';
    c.style.background = `hsl(${Math.random() * 360}, 70%, 65%)`;
    c.style.animationDuration = (2 + Math.random() * 1.2) + 's';
    document.body.appendChild(c);
    setTimeout(() => c.remove(), 3000);
  }
}

// ===== èƒŒæ™¯éŸ³ä¹é¦–æ¬¡ç‚¹å‡» =====
document.body.addEventListener('click', () => {
  if (!firstClickDone) {
    firstClickDone = true;
    bgMusic.volume = 0.35;
    bgMusic.play().catch(() => {});
    confettiEffect(15);
  }
}, {once: true});

// ===== éšæœºé€‰æ‹©ä¸¤ä¸ªä¸åŒçš„å…ƒç´  =====
function getRandomPair(arr) {
  if (arr.length < 2) return arr;
  const idx1 = Math.floor(Math.random() * arr.length);
  let idx2 = Math.floor(Math.random() * (arr.length - 1));
  if (idx2 >= idx1) idx2++;
  return [arr[idx1], arr[idx2]];
}

// ===== æ›´æ–°å¯¹å†³çŠ¶æ€ =====
function updateGameState() {
  if (poolA.length === 0 && winnersPool.length === 0) {
    gameState = 'finished';
  } else if (poolA.length >= 2) {
    gameState = 'poolA_vs_poolA';
  } else if (poolA.length === 1 && winnersPool.length > 0) {
    gameState = 'poolA_vs_winnersPool';
  } else if (winnersPool.length >= 2) {
    gameState = 'winnersPool_vs_winnersPool';
  } else if (winnersPool.length === 1 && poolA.length === 0) {
    showChampion(winnersPool[0]);
    return;
  }
  
  selectNextPair();
}

// ===== é€‰æ‹©ä¸‹ä¸€å¯¹ =====
function selectNextPair() {
  if (gameState === 'finished') return;
  
  if (gameState === 'poolA_vs_poolA') {
    currentPair = getRandomPair(poolA);
    status.textContent = `åˆé‡å¿ƒåŠ¨ ${poolA.length} å¼ å¾…é€‰`;
  } else if (gameState === 'poolA_vs_winnersPool') {
    const fromPoolA = poolA[0];
    const fromWinners = winnersPool[Math.floor(Math.random() * winnersPool.length)];
    currentPair = [fromPoolA, fromWinners];
    status.textContent = `æ–°é¢å­” vs å¿ƒåŠ¨è€å‹`;
  } else if (gameState === 'winnersPool_vs_winnersPool') {
    currentPair = getRandomPair(winnersPool);
    status.textContent = `å¼ºå¼ºå¯¹å†³ ${winnersPool.length} ä½å¿ƒåŠ¨é€‰æ‰‹`;
  }
  
  img1.src = currentPair[0];
  img2.src = currentPair[1];
  
  if (lastLoser && !reviveUsed) {
    reviveBtn.style.display = 'inline';
  }
}

// ===== ç‚¹å‡»é€‰æ‹© =====
function selectImage(idx) {
  const winner = currentPair[idx];
  const loser = currentPair[1 - idx];
  
  if (!winnersPool.includes(winner)) {
    winnersPool.push(winner);
  }
  
  if (poolA.includes(loser)) {
    poolA = poolA.filter(img => img !== loser);
  }
  if (winnersPool.includes(loser)) {
    winnersPool = winnersPool.filter(img => img !== loser);
  }
  
  if (poolA.includes(winner)) {
    poolA = poolA.filter(img => img !== winner);
  }
  
  lastLoser = loser;
  
  if (streakPlayer === winner) {
    streak++;
  } else {
    streakPlayer = winner;
    streak = 1;
  }
  
  if (streak % 10 === 0) {
    confettiEffect(80);
    status.textContent = `å¤©å‘ï¼å·²ç»è¿ç»­ ${streak} æ¬¡ä¸ºå¥¹å¿ƒåŠ¨ ğŸ’˜`;
  } else {
    status.textContent = `å·²è¿ç»­ ${streak} æ¬¡é€‰æ‹©å¥¹ ğŸ’“`;
  }
  
  updateGameState();
}

// ===== å¤æ´»æŒ‰é’® =====
reviveBtn.onclick = () => {
  if (lastLoser && !reviveUsed) {
    poolA.push(lastLoser);
    reviveUsed = true;
    reviveBtn.style.display = 'none';
    status.textContent = 'å¥¹å¸¦ç€ä½ çš„å¿ƒæ„å›æ¥äº† ğŸ’–';
    confettiEffect(12);
    
    if (currentPair.includes(lastLoser)) {
      const flashImg = currentPair[0] === lastLoser ? img1 : img2;
      flashImg.classList.add('flash');
      setTimeout(() => flashImg.classList.remove('flash'), 3000);
    }
  }
}

// ===== æ˜¾ç¤ºå† å†› =====
function showChampion(img) {
  gameState = 'finished';
  img1.style.display = 'none';
  img2.style.display = 'none';
  reviveBtn.style.display = 'none';
  status.style.display = 'none';
  
  winnerBanner.style.display = 'block';
  winnerBanner.innerHTML = `
    <div style="margin-bottom: 15px; font-weight: bold;">
      ğŸ‰ æœ€ç»ˆèƒœå‡ºï¼å¥¹å°±æ˜¯ä½ çš„å¿ƒé€‰ ğŸ‰
    </div>
    <img src="${img}" class="winner-image">
    <div style="margin-top: 10px; font-size: 0.9em;">
      è¿èƒœè®°å½•ï¼š${streak} æ¬¡
    </div>
  `;
  
  confettiEffect(150);
  bgMusic.pause();
}

// ===== ç»‘å®šç‚¹å‡»äº‹ä»¶ =====
img1.onclick = () => selectImage(0);
img2.onclick = () => selectImage(1);

// ===== å¯åŠ¨æ¸¸æˆ =====
updateGameState();

// ===== ç›‘å¬çª—å£å¤§å°å˜åŒ– =====
window.addEventListener('resize', calculateImageHeight);
window.addEventListener('orientationchange', () => {
  setTimeout(calculateImageHeight, 100);
});

// åˆå§‹è®¡ç®—å›¾ç‰‡é«˜åº¦
setTimeout(calculateImageHeight, 50);
</script>
</body>
</html>
